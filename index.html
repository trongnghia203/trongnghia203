<!DOCTYPE html>
<html lang="en"> 
<!-- reference: https://dangthanh.org/2013/10/06/tao-mp3-player-voi-html5-va-css3/ -->
<head>
	<meta charset="utf-8"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/wavesurfer.js/1.2.3/wavesurfer.min.js"></script>
	<link rel="stylesheet" type="text/css" href="style.css">
    <title></title>
</head>
<body>
	<main>
		<div class="player">
		<!--
			<audio id="player__source" src="Ru-Tinh-Hong-Nhung.mp3">
			<p>Trình duyệt của bạn không hỗ trợ HTML5 Audio</p></audio>
			
			<div class="player__loading"></div>
		-->	
			<div class="player__control">
				<div class="top-control">
					<button id="playPause" class="btn btn-primary" onclick="wavesurfer.playPause()"></button>
					
					<div class="sub-title">
						<span class="song-title">Ru Tình - Hồng Nhung Album ABC</span>
						<button id="muted"></button>
						<span id="currentTime" class="line2-subtitle">00:00</span>
						<span class="line2-subtitle">/</span>
						<span id="durationTime" class="line2-subtitle">00:00</span>
					</div>
				</div>
				
				
				<div id="waveform" min="0" type="range" value="0"></div>
				
				<!--
				<div class="bottom-control">
					
					<input id="seek" min="0" type="range" value="0">
					
				</div>
				-->
			</div>
		</div>
	</main>
	
    <script>
	
	$(document).ready(function() {
		var wPlayer = Math.round($(".player").width());
		$(".player").css("height", wPlayer);
		
		var wSongTitle = wPlayer - 100;
		$(".sub-title").css("width", wSongTitle + "px");
		
		$(window).resize(function() {
			var wPlayer = Math.round($(".player").width());
			$(".player").css("height", wPlayer);
			var wSongTitle = wPlayer - 100;
			$(".sub-title").css("width", wSongTitle + "px");
			
			if (wPlayer < 250){
				$(".line2-subtitle").css("display","none");
			}
			else {
				$(".line2-subtitle").css("display","table-cell");
			}
		});
		
	});
	
	
	var wavesurfer = WaveSurfer.create({
		container: '#waveform',
		barWidth: 1,
		waveColor: '#aecfe3',
		progressColor: '#f48a23',
		cursorColor: '#f27d0c',
		cursorWidth: 2,
		height: 90,
		hideScrollbar: true
	});
	
	wavesurfer.load('Ru-Tinh-Hong-Nhung.mp3');
	
//	var player = document.getElementById('player__source'),
//		playLoading = document.querySelectorAll('.player__loading span'),
//		playPause = document.getElementById('playPause'),
//		currentTime = document.getElementById('currentTime'),
//		waveform = document.getElementById('waveform'),
//		durationTime = document.getElementById('durationTime'),
	var	mutedA = document.getElementById("muted");
	
wavesurfer.on('ready', function () {
	
	

	
	playPause.addEventListener('click', playPauseMusic, false);

	function playPauseMusic() {
		if (wavesurfer.isPlaying()) {
			//player.play();
			//wavesurfer.play();
			// Kiểm tra thời gian hiện tại của bài nhạc
			timeInterval = setInterval(timeUpdateMusic, 100);
			// Thay đổi giá trị của seek
			//waveform.addEventListener('change', seekMusic, false);
			$("#playPause").css("background", "url('pause-btn.png') center no-repeat");
			$("#playPause").css("background-size", "60px 60px");
		} else {
			//player.pause();
			//wavesurfer.pause();
			$("#playPause").css("background", "url('play-btn.png') center no-repeat");
			$("#playPause").css("background-size", "60px 60px");
		}
	}
	
	mutedA.addEventListener('click', mutedMusic, false);
	
	function mutedMusic() {
		if (wavesurfer.getMute() == "muted") {
			// Mở âm thanh
			$("#muted").css("display","none");
		} else {
			// Tắt âm thanh
			$("#muted").css("display","none");
		}
	}

	function sformat( s ) {
	// Đổi giây sang MM:ss
		var days	= Math.floor(Math.floor(Math.floor(s/60)/60)/24)%24;	//DAYS
		var hours	= Math.floor(Math.floor(s/60)/60)%60;					//HOURS
		var minutes	= Math.floor(s/60)%60;									//MINUTES
		var seconds	= Math.floor(s)%60;										//SECONDS
		
		if (minutes < 10) {minutes = "0" + minutes;};
		if (seconds < 10) {seconds = "0" + seconds;};
		
		return minutes+':'+seconds;
	}
	
	function timeUpdateMusic() {
		// Thời gian toàn bộ của bài nhạc    
		durationTime.innerHTML = sformat(wavesurfer.getDuration());
		// Thời gian hiện tại của bài nhạc
		currentTime.innerHTML = sformat(wavesurfer.getCurrentTime());
		//waveform.max = wavesurfer.getDuration();
		//waveform.value = wavesurfer.getCurrentTime();
	}
/*
	function seekMusic() {
		wavesurfer.currentTime = waveform.value;
	}
*/	
});
	</script>
</body>
</html>
